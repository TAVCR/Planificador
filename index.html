<!DOCTYPE html>
<html lang="es" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificador Antolog√≠as 2026 (Datos Confirmados)</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#A99D8B">
    <link id="manifest-link" rel="manifest">
    <link id="apple-touch-icon-link" rel="apple-touch-icon">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .nav-active {
            background-color: #A99D8B;
            color: #121212;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .nav-inactive {
            background-color: #2C2C2C;
            color: #A0A0A0;
        }
        .calendar-grid-header, .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            padding: 0 0.5rem;
        }
        .day {
            aspect-ratio: 1 / 1;
            transition: transform 0.2s, box-shadow 0.2s, opacity 0.3s, background-color 0.3s, color 0.3s;
            position: relative;
        }
        .day:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            z-index: 10;
        }
        .day.selected {
            box-shadow: 0 0 0 3px #A99D8B;
            z-index: 20;
        }
        .bg-neutral-day { background-color: #383838; }
        .bg-empty-day { background-color: transparent; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 450px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 400px; }
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
        }
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .filter-btn-active {
            background-color: #8C7B6C !important;
            color: white !important;
            box-shadow: inset 0 2px 4px 0 rgb(0 0 0 / 0.25);
        }
        .day-filtered {
            opacity: 0.15;
            pointer-events: none;
        }
        .priority-star {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.8);
        }
        /* Light/Dark Mode Styles */
        .dark-mode-bg { background-color: #1E1E1E; }
        .dark-mode-text { color: #E0E0E0; }
        .dark-mode-text-header { color: #D4C8B8; }
        .dark-mode-text-accent { color: #BFAE9B; }
        .dark-mode-surface { background-color: #2C2C2C; }
        .dark-mode-border { border-color: #444444; }
        .dark-mode-text-muted { color: #A0A0A0; }
        
        body.light-mode {
            background-color: #F0F0F0;
            color: #333333;
        }
        body.light-mode .dark-mode-surface { background-color: #FFFFFF; }
        body.light-mode .dark-mode-text-header { color: #1A1A1A; }
        body.light-mode .dark-mode-text-muted { color: #666666; }
        body.light-mode .nav-inactive { background-color: #E0E0E0; color: #555555; }
        body.light-mode .bg-neutral-day { background-color: #F5F5F5; color: #555555; }
        body.light-mode .priority-star { color: rgba(0,0,0,0.6); }
        
        /* Buttons */
        .year-btn-active-dark { background-color: #A99D8B !important; color: #121212 !important; }
        .year-btn-inactive-dark { background-color: #2C2C2C !important; color: #A0A0A0 !important; }
        .year-btn-active-light { background-color: #C3B8A8 !important; color: #FFFFFF !important; }
        .year-btn-inactive-light { background-color: #E0E0E0 !important; color: #555555 !important; }
        
        /* Strategies */
        :root {
            --strategy-green-bg: rgba(46, 125, 50, 0.2);
            --strategy-green-border: #2E7D32;
            --strategy-green-text: #A7D9A9;
            --strategy-yellow-bg: rgba(255, 193, 7, 0.2);
            --strategy-yellow-border: #FFC107;
            --strategy-yellow-text: #FFECB3;
            --strategy-red-bg: rgba(198, 40, 40, 0.2);
            --strategy-red-border: #C62828;
            --strategy-red-text: #FFCDD2;
        }
        body.light-mode {
            --strategy-green-bg: #E8F5E9;
            --strategy-green-text: #1B5E20;
            --strategy-yellow-bg: #FFFDE7;
            --strategy-yellow-text: #FF6F00;
            --strategy-red-bg: #FFEBEE;
            --strategy-red-text: #D32F2F;
        }
        .strategy-card[data-category="green"] { background-color: var(--strategy-green-bg); border-left: 4px solid var(--strategy-green-border); color: var(--strategy-green-text); }
        .strategy-card[data-category="yellow"] { background-color: var(--strategy-yellow-bg); border-left: 4px solid var(--strategy-yellow-border); color: var(--strategy-yellow-text); }
        .strategy-card[data-category="red"] { background-color: var(--strategy-red-bg); border-left: 4px solid var(--strategy-red-border); color: var(--strategy-red-text); }

        @media print {
            body * { visibility: hidden; }
            #calendars-container, #calendars-container * { visibility: visible; }
            #calendars-container { position: absolute; left: 0; top: 0; width: 100%; }
            .lg\:col-span-8 { width: 100% !important; }
        }
    </style>
</head>
<body class="dark-mode-text antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-screen-2xl">
        <header class="text-center mb-8 flex flex-col sm:flex-row justify-between items-center">
            <div class="flex flex-col items-center sm:items-start flex-grow">
                <h1 class="text-3xl md:text-5xl font-bold dark-mode-text-header">Planificador Oficial 2025-2026</h1>
                <p class="text-lg dark-mode-text-accent mt-2">Antolog√≠as CR | Datos Verificados</p>
            </div>
            <div class="flex space-x-2 mt-4 sm:mt-0 sm:ml-4">
                <button id="theme-toggle" class="px-4 py-2.5 text-lg bg-gray-700 text-gray-200 font-semibold rounded-lg hover:bg-gray-600 transition-all duration-300">‚òÄÔ∏è</button>
                <button id="colorblind-toggle" class="px-4 py-2.5 text-lg bg-gray-700 text-gray-200 font-semibold rounded-lg hover:bg-gray-600 transition-all duration-300">üåà</button>
            </div>
        </header>

        <nav class="flex flex-wrap justify-center mb-8 dark-mode-surface rounded-full p-1 max-w-xl mx-auto dark-mode-inner-shadow">
            <button id="nav-calendario" class="nav-btn nav-active flex-1 py-2 px-4 rounded-full text-sm sm:text-base font-semibold transition-all duration-300">üìÖ Calendario</button>
            <button id="nav-analisis" class="nav-btn nav-inactive flex-1 py-2 px-4 rounded-full text-sm sm:text-base font-semibold transition-all duration-300">üîç An√°lisis</button>
            <button id="nav-estrategias" class="nav-btn nav-inactive flex-1 py-2 px-4 rounded-full text-sm sm:text-base font-semibold transition-all duration-300">üí° Estrategias</button>
            <button id="nav-clima" class="nav-btn nav-inactive flex-1 py-2 px-4 rounded-full text-sm sm:text-base font-semibold transition-all duration-300">üå¶Ô∏è Clima</button>
        </nav>

        <main id="main-content">
            <!-- CALENDAR VIEW -->
            <div id="view-calendario">
                <p class="text-center dark-mode-text-muted mb-6 max-w-3xl mx-auto">Incluye fechas confirmadas: Bad Bunny (Dic 2025), Ed Sheeran (May 2026), The Killers (Mar 2026) y eventos c√≠clicos locales.</p>
                <div class="flex justify-center items-center mb-6 space-x-4">
                    <button id="year-2025-btn" class="year-btn px-8 py-2.5 text-lg font-semibold rounded-lg shadow-md transition-all duration-300 transform hover:scale-105">Cierre 2025</button>
                    <button id="year-2026-btn" class="year-btn px-8 py-2.5 text-lg font-semibold rounded-lg shadow-md transition-all duration-300 transform hover:scale-105">A√±o 2026</button>
                    <button id="print-btn" class="px-4 py-2.5 text-lg bg-gray-700 text-gray-200 font-semibold rounded-lg hover:bg-gray-600">üñ®Ô∏è</button>
                </div>
                
                <div class="flex flex-wrap justify-center items-center gap-x-4 sm:gap-x-6 gap-y-2 mb-4 text-xs sm:text-sm text-gray-700">
                    <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-green-opportunity mr-2 border border-gray-400"></span>Oportunidad Alta</div>
                    <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-yellow-opportunity mr-2 border border-gray-400"></span>Riesgo Medio</div>
                    <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-red-opportunity mr-2 border border-gray-400"></span>Riesgo Alto</div>
                    <div class="flex items-center"><span class="w-4 h-4 rounded-full bg-blue-payday mr-2 border border-gray-400"></span>D√≠a de Pago</div>
                </div>

                <div id="filter-container" class="flex flex-wrap justify-center items-center gap-2 mb-8 p-2 dark-mode-surface rounded-full max-w-2xl mx-auto">
                    <button class="filter-btn flex-1 py-1 px-3 text-xs sm:text-sm rounded-full" data-filter="all">Todos</button>
                    <button class="filter-btn flex-1 py-1 px-3 text-xs sm:text-sm rounded-full bg-[#383838]" data-filter="green">üü¢ Verdes</button>
                    <button class="filter-btn flex-1 py-1 px-3 text-xs sm:text-sm rounded-full bg-[#383838]" data-filter="yellow">üü° Amarillos</button>
                    <button class="filter-btn flex-1 py-1 px-3 text-xs sm:text-sm rounded-full bg-[#383838]" data-filter="red">üî¥ Rojos</button>
                    <button class="filter-btn flex-1 py-1 px-3 text-xs sm:text-sm rounded-full bg-[#383838]" data-filter="blue">üîµ Pagos</button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <div id="calendars-container" class="lg:col-span-8">
                        <!-- Calendar Grids injected via JS -->
                    </div>

                    <div id="details-panel" class="hidden lg:block lg:col-span-4 p-6 dark-mode-surface rounded-2xl dark-mode-shadow self-start sticky top-8">
                        <h3 class="font-bold text-xl mb-4 dark-mode-text-header">Detalles del Evento</h3>
                        <div id="details-content-desktop" class="dark-mode-text-muted space-y-3 min-h-[150px]">
                            <p class="text-center dark-mode-text-muted pt-8">Selecciona una fecha para ver detalles.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ANALYSIS VIEW -->
            <div id="view-analisis" class="hidden">
                 <div class="max-w-4xl mx-auto p-4 md:p-8 dark-mode-surface rounded-2xl dark-mode-shadow">
                    <h2 class="text-2xl md:text-3xl font-bold text-center mb-4 dark-mode-text-header">An√°lisis de Entorno 2026</h2>
                    <div class="space-y-4" id="accordion-container">
                        <!-- Accordion items injected -->
                    </div>
                </div>
            </div>

            <!-- STRATEGIES VIEW -->
            <div id="view-estrategias" class="hidden">
                 <div class="max-w-6xl mx-auto">
                    <h2 class="text-2xl md:text-3xl font-bold text-center mb-4 dark-mode-text-header">Estrategias por Categor√≠a</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
                        <div id="strategy-card-green" class="strategy-card p-6 rounded-lg shadow-md" data-category="green">
                            <h3 id="strategy-green-title" class="font-bold text-xl mb-3 flex items-center"><span class="text-3xl mr-3">üü¢</span> Maximizar</h3>
                            <ul class="list-disc list-inside space-y-2 text-sm">
                                <li>D√≠as de Pago (15/30): Promociones de c√≥cteles.</li>
                                <li>Ventana Dorada (Dic): Reservas grupos grandes.</li>
                                <li>D√≠a de la Madre/Padre: Men√∫ especial precio fijo.</li>
                            </ul>
                        </div>
                        <div id="strategy-card-yellow" class="strategy-card p-6 rounded-lg shadow-md" data-category="yellow">
                            <h3 class="font-bold text-xl mb-3 flex items-center"><span class="text-3xl mr-3">üü°</span> Navegar</h3>
                            <ul class="list-disc list-inside space-y-2 text-sm">
                                <li>Conciertos en Parque Viva (The Killers/Tyler): Ofrecer "After-Party" si el target coincide.</li>
                                <li>Lluvias (May-Nov): Garantizar confort en terraza.</li>
                            </ul>
                        </div>
                         <div id="strategy-card-red" class="strategy-card p-6 rounded-lg shadow-md" data-category="red">
                            <h3 id="strategy-red-title" class="font-bold text-xl mb-3 flex items-center"><span class="text-3xl mr-3">üî¥</span> Mitigar</h3>
                             <ul class="list-disc list-inside space-y-2 text-sm">
                                <li>Bad Bunny/Ed Sheeran: Competencia total. Considerar m√∫sica en vivo g√©nero opuesto (Trova/Rock Cl√°sico).</li>
                                <li>Elecciones/Semana Santa: Reducir costos operativos.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CLIMATE VIEW -->
            <div id="view-clima" class="hidden">
                <div class="max-w-4xl mx-auto p-4 md:p-8 dark-mode-surface rounded-2xl dark-mode-shadow pt-6 md:pt-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-center mb-4 dark-mode-text-header">Riesgo Clim√°tico Valle Central</h2>
                    <div class="overflow-x-auto">
                        <table id="climate-table" class="w-full text-sm text-left dark-mode-text-muted">
                           <thead class="text-xs dark-mode-text-header uppercase bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 rounded-l-lg">Mes</th>
                                    <th scope="col" class="px-6 py-3">Riesgo</th>
                                    <th scope="col" class="px-6 py-3 rounded-r-lg">Detalle</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Climate data injected -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Modal -->
    <div id="details-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="dark-mode-surface rounded-2xl shadow-2xl p-6 w-full max-w-sm mx-auto transform scale-95 transition-transform duration-300">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-xl dark-mode-text-header">Detalles</h3>
                <button id="modal-close-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div id="details-content-mobile" class="dark-mode-text-muted space-y-3"></div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const defaultColorPalette = {
        opportunityHigh: { bg: '#2E7D32', text: '#FFFFFF' },
        opportunityMedium: { bg: '#FFC107', text: '#3D3B38' },
        opportunityLow: { bg: '#C62828', text: '#FFFFFF' },
        payday: { bg: '#1565C0', text: '#FFFFFF' }
    };

    const colorblindColorPalette = {
        opportunityHigh: { bg: '#9933CC', text: '#FFFFFF' },
        opportunityMedium: { bg: '#FFC107', text: '#3D3B38' },
        opportunityLow: { bg: '#FF6600', text: '#FFFFFF' },
        payday: { bg: '#1565C0', text: '#FFFFFF' }
    };

    let currentActiveColorPalette = defaultColorPalette;
    let currentViewYear = '2025-end'; // Default to end of 2025
    let selectedDayElement = null;
    let isLightMode = localStorage.getItem('theme') === 'light';
    let isColorblindMode = localStorage.getItem('colorblind') === 'true';

    // DOM Elements
    const calendarsContainer = document.getElementById('calendars-container');
    const detailsContentDesktop = document.getElementById('details-content-desktop');
    const detailsContentMobile = document.getElementById('details-content-mobile');
    const modal = document.getElementById('details-modal');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    const themeToggleBtn = document.getElementById('theme-toggle');
    const colorblindToggleBtn = document.getElementById('colorblind-toggle');
    const body = document.body;
    const views = {
        calendario: document.getElementById('view-calendario'),
        analisis: document.getElementById('view-analisis'),
        estrategias: document.getElementById('view-estrategias'),
        clima: document.getElementById('view-clima'),
    };
    const navButtons = {
        calendario: document.getElementById('nav-calendario'),
        analisis: document.getElementById('nav-analisis'),
        estrategias: document.getElementById('nav-estrategias'),
        clima: document.getElementById('nav-clima'),
    };
    const filterButtons = document.querySelectorAll('.filter-btn');

    // ============================================================================
    // DATOS VERIFICADOS (ETICKET, TELETICA, BACKSTAGE MAGAZINE)
    // ============================================================================
    const eventData = {
        // --- DICIEMBRE 2025 ---
        '2025-12-01': { cat: 'green', day: 'Lunes', reason: 'Inicio Ventana Dorada (Aguinaldos).' },
        '2025-12-02': { cat: 'yellow', day: 'Martes', reason: 'Concierto Limp Bizkit (Parque Viva). Competencia nicho Rock.' },
        '2025-12-05': { cat: 'red', day: 'Viernes', reason: 'BAD BUNNY (Estadio Nacional). Competencia Masiva. Tr√°fico colapsado en Sabana.' },
        '2025-12-06': { cat: 'red', day: 'S√°bado', reason: 'BAD BUNNY (Estadio Nacional). Competencia Masiva. 2da fecha.' },
        '2025-12-12': { cat: 'green', day: 'Viernes', reason: 'Pico Ventana Dorada. Cenas navide√±as.' },
        '2025-12-13': { cat: 'green', day: 'S√°bado', reason: 'Pico Ventana Dorada.' },
        '2025-12-15': { cat: 'blue', day: 'Lunes', reason: 'Quincena.' },
        '2025-12-19': { cat: 'green', day: 'Viernes', reason: 'Viernes pre-Navidad. Demanda muy alta.' },
        '2025-12-25': { cat: 'red', day: 'Jueves', reason: 'Navidad. Inicio Fiestas Zapote.' },
        '2025-12-26': { cat: 'red', day: 'Viernes', reason: 'Tope Nacional (Zapote). Tr√°fico dif√≠cil.' },
        '2025-12-30': { cat: 'blue', day: 'Martes', reason: 'Pago Fin de Mes.' },
        '2025-12-31': { cat: 'yellow', day: 'Mi√©rcoles', reason: 'Fin de A√±o. Solo reservas.' },

        // --- ENERO 2026 ---
        '2026-01-01': { cat: 'red', day: 'Jueves', reason: 'A√±o Nuevo.' },
        '2026-01-15': { cat: 'blue', day: 'Jueves', reason: 'Quincena.' },
        '2026-01-16': { cat: 'red', day: 'Viernes', reason: 'Inicio Fiestas Palmares. √âxodo.' },
        '2026-01-17': { cat: 'red', day: 'S√°bado', reason: 'Fiestas Palmares.' },
        '2026-01-24': { cat: 'red', day: 'S√°bado', reason: 'Cierre Palmares.' },
        '2026-01-30': { cat: 'blue', day: 'Viernes', reason: 'Quincena. Veda Electoral inicia medianoche.' },
        '2026-01-31': { cat: 'red', day: 'S√°bado', reason: 'VEDA ELECTORAL. Ley Seca probable.' },

        // --- FEBRERO 2026 ---
        '2026-02-01': { cat: 'red', day: 'Domingo', reason: 'ELECCIONES NACIONALES. Pa√≠s enfocado en urnas.' },
        '2026-02-07': { cat: 'yellow', day: 'S√°bado', reason: 'Viva los 90s Fest (Parque Viva). P√∫blico adulto contempor√°neo (target similar).' },
        '2026-02-13': { cat: 'green', day: 'Viernes', reason: 'Quincena + Pre-San Valent√≠n.' },
        '2026-02-14': { cat: 'green', day: 'S√°bado', reason: 'San Valent√≠n. Demanda M√°xima.' },
        '2026-02-28': { cat: 'red', day: 'S√°bado', reason: 'X-Knights (Estadio Nacional). Evento familiar masivo. Pago fin de mes.' },

        // --- MARZO 2026 ---
        '2026-03-13': { cat: 'green', day: 'Viernes', reason: 'Fin de semana Quincena.' },
        '2026-03-15': { cat: 'blue', day: 'Domingo', reason: 'Quincena.' },
        '2026-03-18': { cat: 'yellow', day: 'Mi√©rcoles', reason: 'Tyler, The Creator (Parque Viva). P√∫blico joven/nicho.' },
        '2026-03-25': { cat: 'yellow', day: 'Mi√©rcoles', reason: 'THE KILLERS (Parque Viva). Competencia directa p√∫blico adulto/rock.' },
        '2026-03-28': { cat: 'red', day: 'S√°bado', reason: 'Inicio Semana Santa (√âxodo).' },
        '2026-03-30': { cat: 'blue', day: 'Lunes', reason: 'Pago Fin de Mes.' },

        // --- ABRIL 2026 ---
        '2026-04-02': { cat: 'red', day: 'Jueves', reason: 'Jueves Santo.' },
        '2026-04-03': { cat: 'red', day: 'Viernes', reason: 'Viernes Santo (Ley Seca).' },
        '2026-04-05': { cat: 'red', day: 'Domingo', reason: 'Posible 2da Ronda Electoral.' },
        '2026-04-11': { cat: 'red', day: 'S√°bado', reason: 'Feriado Juan Santamar√≠a. Fin de semana largo.' },
        '2026-04-15': { cat: 'blue', day: 'Mi√©rcoles', reason: 'Quincena.' },
        '2026-04-29': { cat: 'yellow', day: 'Mi√©rcoles', reason: 'Laura Pausini (Estadio Nacional). P√∫blico adulto balada.' },
        '2026-04-30': { cat: 'blue', day: 'Jueves', reason: 'Pago Fin de Mes.' },

        // --- MAYO 2026 ---
        '2026-05-01': { cat: 'red', day: 'Viernes', reason: 'D√≠a del Trabajador. Feriado.' },
        '2026-05-15': { cat: 'blue', day: 'Viernes', reason: 'Quincena.' },
        '2026-05-30': { cat: 'red', day: 'S√°bado', reason: 'ED SHEERAN (Estadio Nacional). Competencia Masiva. Tr√°fico Sabana.' },

        // --- JUNIO 2026 ---
        '2026-06-11': { cat: 'yellow', day: 'Jueves', reason: 'Inicio MUNDIAL 2026.' },
        '2026-06-15': { cat: 'blue', day: 'Lunes', reason: 'Quincena.' },
        '2026-06-20': { cat: 'green', day: 'S√°bado', reason: 'D√≠a del Padre.' },
        '2026-06-30': { cat: 'blue', day: 'Martes', reason: 'Pago Fin de Mes.' },

        // --- JULIO 2026 ---
        '2026-07-15': { cat: 'blue', day: 'Mi√©rcoles', reason: 'Quincena.' },
        '2026-07-19': { cat: 'red', day: 'Domingo', reason: 'Final Mundial 2026.' },
        '2026-07-25': { cat: 'red', day: 'S√°bado', reason: 'Anexi√≥n Nicoya. Feriado/√âxodo.' },
        '2026-07-31': { cat: 'blue', day: 'Viernes', reason: 'Pago Fin de Mes.' },

        // --- AGOSTO 2026 ---
        '2026-08-01': { cat: 'red', day: 'S√°bado', reason: 'Romer√≠a. Caos vial Cartago.' },
        '2026-08-14': { cat: 'green', day: 'Viernes', reason: 'V√≠spera D√≠a Madre + Quincena.' },
        '2026-08-15': { cat: 'green', day: 'S√°bado', reason: 'D√≠a de la Madre. Restaurantes llenos.' },

        // --- SEPTIEMBRE 2026 ---
        '2026-09-14': { cat: 'green', day: 'Lunes', reason: 'Desfile Faroles.' },
        '2026-09-15': { cat: 'blue', day: 'Martes', reason: 'Independencia. Feriado.' },
        '2026-09-30': { cat: 'blue', day: 'Mi√©rcoles', reason: 'Pago Fin de Mes.' },

        // --- OCTUBRE 2026 ---
        '2026-10-15': { cat: 'blue', day: 'Jueves', reason: 'Quincena.' },
        '2026-10-31': { cat: 'green', day: 'S√°bado', reason: 'Halloween. Alta demanda bares.' },

        // --- NOVIEMBRE 2026 ---
        '2026-11-15': { cat: 'blue', day: 'Domingo', reason: 'Quincena.' },
        '2026-11-18': { cat: 'yellow', day: 'Mi√©rcoles', reason: 'Eros Ramazzotti (Estadio Nacional). P√∫blico adulto.' },
        '2026-11-27': { cat: 'green', day: 'Viernes', reason: 'Black Friday.' },
        '2026-11-30': { cat: 'blue', day: 'Lunes', reason: 'Pago Fin de Mes.' },

        // --- DICIEMBRE 2026 ---
        '2026-12-01': { cat: 'green', day: 'Martes', reason: 'Inicio Aguinaldos 2026.' },
        '2026-12-15': { cat: 'blue', day: 'Martes', reason: 'Quincena.' },
        '2026-12-25': { cat: 'red', day: 'Viernes', reason: 'Navidad.' }
    };

    const climateData = [
        { month: 'Enero', risk: 'üü¢', justification: 'Seco. Ideal para terrazas.' },
        { month: 'Febrero', risk: 'üü¢', justification: 'Seco y ventoso.' },
        { month: 'Marzo', risk: 'üü¢', justification: 'Seco y caliente.' },
        { month: 'Abril', risk: 'üü°', justification: 'Transici√≥n. Lluvias finales mes.' },
        { month: 'Mayo', risk: 'üü°', justification: 'Inicio lluvias vespertinas.' },
        { month: 'Junio', risk: 'üü°', justification: 'Lluvias regulares.' },
        { month: 'Julio', risk: 'üü°', justification: 'Veranillo posible.' },
        { month: 'Agosto', risk: 'üü°', justification: 'Lluvias.' },
        { month: 'Septiembre', risk: 'üî¥', justification: 'RIESGO ALTO. Temporales.' },
        { month: 'Octubre', risk: 'üî¥', justification: 'RIESGO M√ÅXIMO. Lluvias intensas.' },
        { month: 'Noviembre', risk: 'üü°', justification: 'Transici√≥n hacia seco.' },
        { month: 'Diciembre', risk: 'üü¢', justification: 'Vientos alisios, clima fresco.' },
    ];

    const analysisContent = [
        { title: 'El Fen√≥meno Bad Bunny (Dic 2025)', content: 'La confirmaci√≥n del concierto de Bad Bunny para el 5 y 6 de diciembre 2025 altera el inicio de la temporada alta. Se espera colapso vial en La Sabana y alrededores desde la tarde. Recomendaci√≥n: Enfocar marketing en "After-Party" o almuerzos previos, evitar eventos que requieran puntualidad estricta en la noche.' },
        { title: 'Conciertos 2026 Confirmados', content: '2026 trae grandes nombres: The Killers (Marzo) y Ed Sheeran (Mayo). Ed Sheeran en particular (S√°bado 30 Mayo) ser√° un evento masivo en el Estadio Nacional que competir√° por el presupuesto de ocio de fin de mes.' },
        { title: 'Elecciones y Ley Seca', content: 'Recuerde que febrero y abril 2026 son meses electorales. La Ley Seca suele aplicar el d√≠a previo y el d√≠a de la elecci√≥n, prohibiendo la venta de licor. Planifique inventario y personal acorde a esta restricci√≥n.' }
    ];

    // --- LOGIC FUNCTIONS ---

    const injectColorStyles = (palette) => {
        let style = document.getElementById('dynamic-color-styles');
        if (!style) {
            style = document.createElement('style');
            style.id = 'dynamic-color-styles';
            document.head.appendChild(style);
        }
        style.innerHTML = `
            .bg-green-opportunity { background-color: ${palette.opportunityHigh.bg}; color: ${palette.opportunityHigh.text}; }
            .bg-yellow-opportunity { background-color: ${palette.opportunityMedium.bg}; color: ${palette.opportunityMedium.text}; }
            .bg-red-opportunity { background-color: ${palette.opportunityLow.bg}; color: ${palette.opportunityLow.text}; }
            .bg-blue-payday { background-color: ${palette.payday.bg}; color: ${palette.payday.text}; }
        `;
        
        const root = document.documentElement;
        root.style.setProperty('--strategy-green-border', palette.opportunityHigh.bg);
        root.style.setProperty('--strategy-red-border', palette.opportunityLow.bg);
        root.style.setProperty('--strategy-yellow-border', palette.opportunityMedium.bg);
        
        if (isColorblindMode) {
            root.style.setProperty('--strategy-green-bg', `${palette.opportunityHigh.bg}20`);
            root.style.setProperty('--strategy-green-text', '#CC99FF');
            root.style.setProperty('--strategy-red-bg', `${palette.opportunityLow.bg}20`);
            root.style.setProperty('--strategy-red-text', '#FFCC99');
        } else {
            root.style.setProperty('--strategy-green-bg', `rgba(46, 125, 50, 0.2)`);
            root.style.setProperty('--strategy-green-text', `#A7D9A9`);
            root.style.setProperty('--strategy-red-bg', `rgba(198, 40, 40, 0.2)`);
            root.style.setProperty('--strategy-red-text', `#FFCDD2`);
        }
    };

    const getDayClass = (dateString) => {
        const data = eventData[dateString];
        if (data) {
            if (data.cat === 'green') return 'bg-green-opportunity';
            if (data.cat === 'yellow') return 'bg-yellow-opportunity';
            if (data.cat === 'red') return 'bg-red-opportunity';
            if (data.cat === 'blue') return 'bg-blue-payday';
        }
        return 'bg-neutral-day';
    };

    const generateMonthGrid = (year, month) => {
        const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        const dayNames = ["D", "L", "K", "M", "J", "V", "S"];
        
        let html = `<div class="p-4 dark-mode-surface rounded-xl shadow-sm h-full">
                <h3 class="font-bold text-center mb-3 text-lg dark-mode-text-header">${monthNames[month]} ${year}</h3>
                <div class="calendar-grid-header text-xs">`;
        
        dayNames.forEach(day => html += `<div class="font-semibold text-center dark-mode-text-accent">${day}</div>`);
        html += `</div><div class="calendar-grid text-sm">`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
            html += `<div class="bg-empty-day rounded-full"></div>`;
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dateObj = new Date(year, month, day);
            const y = dateObj.getFullYear();
            const m = String(dateObj.getMonth() + 1).padStart(2, '0');
            const d = String(dateObj.getDate()).padStart(2, '0');
            const dateString = `${y}-${m}-${d}`;
            
            const dayClass = getDayClass(dateString);
            let extraClasses = "day flex items-center justify-center font-semibold rounded-full cursor-pointer";
            if (dayClass === 'bg-neutral-day') extraClasses += " text-gray-400";
            
            const hasStar = eventData[dateString]?.cat === 'green' ? '<span class="priority-star">‚≠ê</span>' : '';
            html += `<div class="${dayClass} ${extraClasses}" data-date="${dateString}">${day}${hasStar}</div>`;
        }
        html += `</div></div>`;
        return html;
    };

    const renderCalendars = (view) => {
        let html = `<div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">`;
        
        if (view === '2025-end') {
            html += generateMonthGrid(2025, 11); // Only Dec 2025
        } else {
            for (let m = 0; m < 12; m++) {
                html += generateMonthGrid(2026, m);
            }
        }
        html += `</div>`;
        calendarsContainer.innerHTML = html;
    };

    const showDayDetails = (dateString) => {
        const data = eventData[dateString];
        const [y, m, d] = dateString.split('-');
        const date = new Date(y, m - 1, d);
        
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const formattedDate = date.toLocaleDateString('es-CR', options);

        let html = `<h4 class="font-bold text-lg capitalize mb-2">${formattedDate}</h4>`;
        
        if (data) {
            let emoji = data.cat === 'green' ? 'üü¢' : data.cat === 'yellow' ? 'üü°' : data.cat === 'red' ? 'üî¥' : 'üîµ';
            let text = data.cat === 'green' ? 'Oportunidad Alta' : data.cat === 'yellow' ? 'Riesgo Medio' : data.cat === 'red' ? 'Riesgo Alto' : 'D√≠a de Pago';
            let color = currentActiveColorPalette.opportunityHigh.bg;
            if (data.cat === 'yellow') color = currentActiveColorPalette.opportunityMedium.bg;
            if (data.cat === 'red') color = currentActiveColorPalette.opportunityLow.bg;
            if (data.cat === 'blue') color = currentActiveColorPalette.payday.bg;

            html += `<p class="font-bold text-lg" style="color:${color}">${emoji} ${text}</p>`;
            html += `<p class="mt-4 text-sm"><span class="font-semibold opacity-75">Justificaci√≥n:</span><br>${data.reason}</p>`;
        } else {
             html += `<p class="opacity-50">D√≠a regular sin eventos cr√≠ticos registrados.</p>`;
        }

        if (window.innerWidth < 1024) {
            detailsContentMobile.innerHTML = html;
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div').classList.remove('scale-95');
            }, 10);
        } else {
            detailsContentDesktop.innerHTML = html;
        }
    };

    // --- UI & EVENT LISTENERS ---

    const updateActiveYearBtn = (view) => {
        currentViewYear = view;
        const btn25 = document.getElementById('year-2025-btn');
        const btn26 = document.getElementById('year-2026-btn');
        
        const activeClass = isLightMode ? 'year-btn-active-light' : 'year-btn-active-dark';
        const inactiveClass = isLightMode ? 'year-btn-inactive-light' : 'year-btn-inactive-dark';

        [btn25, btn26].forEach(b => {
            b.classList.remove('year-btn-active-light', 'year-btn-active-dark', 'year-btn-inactive-light', 'year-btn-inactive-dark');
        });

        if (view === '2025-end') {
            btn25.classList.add(activeClass);
            btn26.classList.add(inactiveClass);
        } else {
            btn26.classList.add(activeClass);
            btn25.classList.add(inactiveClass);
        }
        renderCalendars(view);
    };

    const applyTheme = (light) => {
        if (light) {
            body.classList.add('light-mode');
            themeToggleBtn.textContent = 'üåô';
        } else {
            body.classList.remove('light-mode');
            themeToggleBtn.textContent = '‚òÄÔ∏è';
        }
        updateActiveYearBtn(currentViewYear);
        injectColorStyles(currentActiveColorPalette);
    };

    const filterCalendar = (cat) => {
        const days = document.querySelectorAll('.day');
        days.forEach(d => {
            d.classList.remove('day-filtered');
            if (cat === 'all') return;
            
            const dDate = d.dataset.date;
            const dData = eventData[dDate];
            const dCat = dData ? dData.cat : 'neutral';

            if (cat !== dCat) d.classList.add('day-filtered');
        });
    };

    // Init Analysis Accordion
    const initAccordion = () => {
        const container = document.getElementById('accordion-container');
        let html = '';
        analysisContent.forEach(item => {
            html += `
                <div class="border dark-mode-border rounded-lg">
                    <button class="accordion-button w-full flex justify-between items-center text-left p-4 bg-[#383838] hover:bg-[#444444] rounded-lg transition-colors duration-300">
                        <span class="font-semibold text-lg dark-mode-text-header">${item.title}</span>
                        <svg class="w-6 h-6 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content dark-mode-surface rounded-b-lg px-4">
                        <p class="dark-mode-text-muted py-4">${item.content}</p>
                    </div>
                </div>`;
        });
        container.innerHTML = html;
        
        container.querySelectorAll('.accordion-button').forEach(btn => {
            btn.addEventListener('click', () => {
                const content = btn.nextElementSibling;
                const icon = btn.querySelector('svg');
                const isOpen = content.style.maxHeight;
                
                container.querySelectorAll('.accordion-content').forEach(c => c.style.maxHeight = null);
                container.querySelectorAll('svg').forEach(s => s.style.transform = 'rotate(0deg)');

                if (!isOpen) {
                    content.style.maxHeight = content.scrollHeight + "px";
                    icon.style.transform = 'rotate(180deg)';
                }
            });
        });
    };

    // Init Climate Table
    const initClimate = () => {
        const tbody = document.querySelector('#climate-table tbody');
        let html = '';
        climateData.forEach(c => {
            let colorClass = c.risk.includes('üü¢') ? 'text-green-400' : c.risk.includes('üü°') ? 'text-yellow-400' : 'text-red-400';
            html += `<tr class="border-b dark-mode-border">
                <th class="px-6 py-4 font-medium text-gray-100">${c.month}</th>
                <td class="px-6 py-4 ${colorClass} font-bold text-lg">${c.risk}</td>
                <td class="px-6 py-4">${c.justification}</td>
            </tr>`;
        });
        tbody.innerHTML = html;
    };

    // Listeners
    document.getElementById('year-2025-btn').addEventListener('click', () => updateActiveYearBtn('2025-end'));
    document.getElementById('year-2026-btn').addEventListener('click', () => updateActiveYearBtn('2026'));
    document.getElementById('print-btn').addEventListener('click', () => window.print());
    
    themeToggleBtn.addEventListener('click', () => {
        isLightMode = !isLightMode;
        localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
        applyTheme(isLightMode);
    });

    document.getElementById('colorblind-toggle').addEventListener('click', () => {
        isColorblindMode = !isColorblindMode;
        localStorage.setItem('colorblind', isColorblindMode);
        currentActiveColorPalette = isColorblindMode ? colorblindColorPalette : defaultColorPalette;
        injectColorStyles(currentActiveColorPalette);
        renderCalendars(currentViewYear);
    });

    calendarsContainer.addEventListener('click', (e) => {
        const d = e.target.closest('.day');
        if (d) {
            if (selectedDayElement) selectedDayElement.classList.remove('selected');
            d.classList.add('selected');
            selectedDayElement = d;
            showDayDetails(d.dataset.date);
        }
    });

    Object.keys(navButtons).forEach(key => {
        navButtons[key].addEventListener('click', () => {
            Object.values(views).forEach(v => v.classList.add('hidden'));
            Object.values(navButtons).forEach(b => {
                b.classList.remove('nav-active');
                b.classList.add('nav-inactive');
            });
            views[key].classList.remove('hidden');
            navButtons[key].classList.add('nav-active');
            navButtons[key].classList.remove('nav-inactive');
        });
    });

    filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            filterButtons.forEach(b => b.classList.remove('filter-btn-active'));
            btn.classList.add('filter-btn-active');
            filterCalendar(btn.dataset.filter);
        });
    });

    modalCloseBtn.addEventListener('click', () => {
        modal.classList.add('opacity-0');
        setTimeout(() => modal.classList.add('hidden'), 300);
    });

    // Init
    injectColorStyles(currentActiveColorPalette);
    applyTheme(isLightMode);
    renderCalendars(currentViewYear);
    initAccordion();
    initClimate();
});
</script>
</body>
</html>
